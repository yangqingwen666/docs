---
title: "系统镜像"
weight: 1
description: 系统镜像用于创建虚拟机和裸金属设备。
---

系统镜像从格式上主要分为两大类，包括虚拟机镜像和ISO镜像，如下表所示：

| 镜像格式     | 格式                  | 特点                                                         | 用法                                                         |
| ------------ | --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 虚拟机镜像 | QCOW2、VMDK、RAW、VHD | 用于创建虚拟机和裸金属等，一个镜像拥有多种格式，确保镜像可以适配多个平台，开机即可使用，无需安装操作系统等。 | 当镜像是公共镜像时，创建虚拟机时需要在公共镜像中选择，当镜像是自定义镜像时，创建虚拟机时需要在自定义镜像中选择。 |
| ISO镜像      | ISO                  | 仅用于创建{{<oem_name>}}平台的虚拟机。虚拟机安装完成后还需要远程登录虚拟机进行安装操作系统等操作 | 无论ISO镜像是什么镜像类型，创建虚拟机时选择从ISO启动中选择ISO镜像                       |

系统镜像从类型上可分为公共镜像和自定义镜像，如下表所示：

| 镜像类型   | 说明                                     | 来源                                                         |
| ---------- | ---------------------------------------- | ------------------------------------------------------------ |
| 公共镜像   | 共享范围默认为系统共享，不允许更改共享范围。 | 管理员从镜像市场导入的镜像；管理员将所在项目的自定义镜像设置为公共镜像。 |
| 自定义镜像 | 共享范围默认为私有，可设置共享范围。     | 任意用户上传的镜像；通过保存系统镜像生成的镜像；管理员将所在项目的公共镜像设置为自定义镜像。 |


**云管平台镜像使用规则**：

- 在私有云和本地IDC创建虚拟机使用云管平台上的镜像时，镜像将以镜像缓存的形式保存到对应宿主机的本地存储；
- 公有云使用云管平台上镜像时，镜像将会缓存到公有云平台，已缓存的镜像在创建虚拟机时选择镜像时可以查看到镜像带有已缓存的标志。

**入口**：在云管平台单击左上角![](../../../images/intro/nav.png)导航菜单，在弹出的左侧菜单栏中单击 **_"主机/镜像/系统镜像"_** 菜单项，进入系统镜像页面。

![](../../../images/computing/sysimage.png)

## 上传系统镜像

该功能用于上传系统镜像文件，用户上传的镜像文件默认为自定义镜像。

1. 在系统镜像页面，单击 **_"上传"_** 按钮，进入上传镜像页面。
2. 设置以下参数：
   - 指定项目：选择系统镜像的所属项目。
   - 镜像名称：设置镜像的名称，建议名称与镜像的发行版本相关。
   - CPU架构：支持x86和ARM架构。
      - 上传方式：支持上传镜像文件和输入镜像URL两种方式。虚拟机镜像列表支持上传后缀为QCOW2、VMDK、RAW、VHD格式的镜像。ISO镜像列表仅支持上传ISO后缀的镜像。
     - 上传镜像文件：表示选择当前浏览器可访问的镜像直接上传。
     - 输入镜像URL：通过URL路径来添加镜像。目前仅支持以http、https开头的url链接。格式为 [http://path/file](http://path/file) 或 [https://path/file](https://path/file)。
   - 操作系统：支持Linux、Windows和其它。
   - 镜像加密：启用镜像加密，镜像将被所选的密钥加密。

## 新建虚拟机

该功能用于基于系统镜像创建虚拟机。

1. 在系统镜像页面，单击镜像右侧操作列 **_"新建虚拟机"_** 按钮，弹出新建虚拟机对话框。
2. 选择平台为本地IDC、私有云、公有云，单击 **_"确定"_** 按钮，跳转到新建虚拟机页面。
3. 配置其他参数，单击 **_"新建"_** 按钮，创建虚拟机。

## 修改属性

该功能用于修改系统镜像的属性信息。

1. 在系统镜像页面，单击镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"修改属性"_** 菜单项，弹出修改属性对话框。
2. 支持修改以下参数：
     - 名称：设置镜像的名称，建议名称与镜像的发行版本相关。
     - CPU架构：包括x86和ARM。
     - 操作系统：包括Linux、Windows、macOS、VMware以及其他操作系统。
     - 发行版：选择镜像的发行版本。
     - 最小磁盘要求：要求使用镜像创建的主机设备最小配置要求。
     - 磁盘驱动：包括系统自动选择、virtio、scsi、pvscsi、ide、sata。根据磁盘类型选择对应的驱动，建议选择”系统自动选择“。
     - 网卡驱动：包括系统自动选择、virtio、e1000、vmxnet3。建议选择“系统自动选择”。
3. 单击 **_"确定"_** 按钮，完成修改。

## 设置为公共镜像/自定义镜像

仅系统管理员支持将管理员所在项目的自定义镜像设置为公共镜像或将所在项目的公共镜像设置为自定义镜像。

- 公共镜像：公共镜像默认系统共享，共享范围不可更改。
- 自定义镜像：自定义镜像默认为私有，可设置共享范围。

1. 在系统镜像页面，单击“自定义镜像”类型的镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置为公共镜像"_** 菜单项，将自定义镜像设置为公共镜像。
2. 在系统镜像页面，单击“公共镜像”类型的镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置为自定义"_** 菜单项，将公共镜像设置为自定义镜像。

## 设置共享

该功能用于设置系统镜像的共享范围，仅自定义镜像支持设置共享。

项目资源的共享范围有五种：

- 不共享（私有）：即项目资源只能本项目的用户可以使用。
- 项目共享-部分（本域内多项目共享）：即项目资源可以共享到同域下的指定项目（一个或多个），只有本项目和被共享项目下的用户可以使用项目资源。
- 项目共享-全部（本域共享）：即项目资源可以共享给域下所有项目，即项目所在域的用户都可以使用项目资源。
- 域共享-部分（多域共享）：即项目资源可以共享到指定域（一个或多个），只有项目资源所在域和共享域下的用户可以使用项目资源。
- 域共享-全部（全局共享）：即项目资源可以共享给全部域使用，即系统中所有用户都可以使用项目资源。

{{% alert title="说明" %}}
设置域共享的条件：

- 在{{<oem_name>}}平台已开启三级权限。
- 用户处于管理后台。

设置项目共享的条件：

- 用户处于管理后台或域管理后台。

{{% /alert %}}

**单个系统镜像设置共享**

1. 在系统镜像页面，单击镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数。
   - 当共享范围选择为“不共享”时，即项目资源的共享范围为私有，仅本项目的用户可以使用。
   - 当共享范围选择为“项目共享”时，需要选择本域下可共享的项目。
       - 当项目选择同域下的一个或多个项目时，即项目资源的共享范围为项目共享-部分，只有项目资源所在项目和共享项目下的用户可以使用项目资源。
       - 当项目选择全部时，即项目资源的共享范围为项目共享-全部，项目所在域下的用户都可以使用项目资源。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即项目资源的共享范围为域共享-部分，只有项目资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即项目资源的共享范围为域共享-全部，系统中的所有用户都可以使用项目资源。
3. 单击 **_"确定"_** 按钮，完成操作。

**批量设置共享**

1. 在系统镜像列表中选择一个或多个系统镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数。
   - 当共享范围选择为“不共享”时，即项目资源的共享范围为私有，仅本项目的用户可以使用。
   - 当共享范围选择为“项目共享”时，需要选择本域下可共享的项目。
       - 当项目选择同域下的一个或多个项目时，即项目资源的共享范围为项目共享-部分，只有项目资源所在项目和共享项目下的用户可以使用项目资源。
       - 当项目选择全部时，即项目资源的共享范围为项目共享-全部，项目所在域下的用户都可以使用项目资源。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即项目资源的共享范围为域共享-部分，只有项目资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即项目资源的共享范围为域共享-全部，系统中的所有用户都可以使用项目资源。
3. 单击 **_"确定"_** 按钮，完成操作。

## 更改项目

该功能用于更改系统镜像的所属项目。

**单个系统镜像更改项目**

1. 在系统镜像页面，单击镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"更改项目"_** 菜单项，弹出更改项目对话框。
2. 选择域和域下的项目，单击 **_"确定"_** 按钮，完成操作。

**批量更改项目**

1. 在系统镜像列表中选择一个或多个系统镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"更改项目"_** 菜单项，弹出更改项目对话框。
2. 选择域和域下的项目，单击 **_"确定"_** 按钮，完成操作。

## 合并镜像

该功能用于将两个及以上的系统镜像合并为一个主机镜像。

1. 在系统镜像列表中选择两个以上系统镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"合并镜像"_** 菜单项，弹出合并镜像对话框。
2. 输入合并镜像的名称，设置镜像顺序，镜像顺序对应创建主机时磁盘顺序。系统盘、数据盘1、数据盘2、数据盘n，需保证顺序与实际一致。
3. 单击 **_"确定"_** 按钮，完成操作。

## 设置删除保护

该功能用于设置系统镜像的删除保护。当系统镜像启用删除保护后，系统镜像无法被删除；当系统镜像禁用删除保护后，系统镜像才可以被删除。

**单个系统镜像设置删除保护**

1. 禁用删除保护：
    - 单击系统镜像名称右侧带有![](../../../images/computing/delprotect1.png)图标时，单击系统镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置删除保护"_** 菜单项，弹出设置删除保护对话框。
    - 选择“禁用”删除保护，单击 **_"确定"_** 按钮。
2. 启用删除保护：
    - 当系统镜像名称右侧不带![](../../../images/computing/delprotect1.png)图标时，单击系统镜像右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置删除保护"_** 菜单项，弹出设置删除保护对话框。
    - 选择“启用”删除保护，单击 **_"确定"_** 按钮。

**批量设置删除保护**

1. 禁用删除保护：
    - 在系统镜像列表中勾选一个或多个系统镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"设置删除保护"_** 菜单项，弹出设置删除保护对话框。
    - 选择“禁用”删除保护，单击 **_"确定"_** 按钮，批量为系统镜像禁用删除保护。
2. 启用删除保护：
    - 在系统镜像列表中勾选一个或多个系统镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"设置删除保护"_** 菜单项，弹出设置删除保护对话框。
    - 选择“启用”删除保护，单击 **_"确定"_** 按钮，批量为系统镜像启用删除保护。


## 删除

该功能用于删除系统镜像，当系统镜像名称项右侧有![](../../../images/computing/delprotect1.png)图标，表示系统镜像启用了删除保护，无法删除系统镜像，如需删除系统镜像，需要先禁用删除保护。从镜像市场导入的系统镜像删除后将重新回到未导入页面。

{{% alert title="说明" %}}
- 管理员可以删除所有系统镜像。
- 域管理员只可以删除本域的系统镜像。
- 项目用户只可以删除本项目的系统镜像。
{{% /alert %}}

**单个删除**

1. 在系统镜像页面，单击镜像右侧操作列的 **_"更多"_** 按钮，选择下拉菜单 **_"删除"_** 菜单项，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作。

**批量删除**

1. 在系统镜像列表中选择一个或多个镜像，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"删除"_** 菜单项，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作。

## 查看系统镜像详情

该功能用于查看系统镜像的详细信息。

1. 在系统镜像页面，单击镜像名称项，进入系统镜像详情页面。
2. 详情页面顶部菜单项支持对镜像镜像管理操作。
3. 查看镜像的信息。
     - 基本信息：包括云上ID、ID、名称、状态、域、项目、共享范围、类型、大小、创建时间、更新时间、备注。
     - 镜像属性：包括磁盘格式、系统语言、最小内存要求、最小磁盘要求、磁盘驱动、网卡驱动、应用平台。
     - 多云镜像：除ISO格式的镜像外，其他格式镜像导入到{{<oem_name>}}平台时都会转换成3份不同格式的镜像，多云镜像可查看镜像的校验和、格式、大小以及状态。
{{% alert title="说明" %}}
用户从镜像市场或手动上传的镜像都会保存在First Node服务器的/opt/cloud/workspace/data/glance/image目录下。以镜像ID为名称保存1~3份不同格式的镜像。
{{% /alert %}}
     - 其他信息：支持开启或关闭删除保护。

### 查看镜像缓存

该功能用于查看镜像的缓存列表，并支持新建和删除镜像缓存。仅管理员视图支持查看并管理镜像缓存。

1. 在系统镜像页面，单击镜像名称项，进入系统镜像详情页面。
2. 单击“缓存列表”页签，进入缓存页面。
3. 在缓存页面查看镜像的缓存位置、状态、更新时间、平台、区域、云账号等信息。
     - 缓存位置：{{<oem_name>}}平台以及私有云平台中缓存位置对应宿主机；公有云平台缓存位置对应公有云平台上的区域。

#### 新建镜像缓存

默认情况下，用户在{{<oem_name>}}或私有云平台上创建虚拟机时，选择的镜像将缓存到对应宿主机上；
用户在公有云平台上创建虚拟机时，选择的镜像将缓存到对应平台的区域中。

除上述缓存方法外，云管平台支持定向将镜像事先缓存到对应宿主机和平台区域中，可提高创建虚拟机的速度等。

##### 缓存到IDC

1. 在缓存页面页面，单击列表上方 **_"新建"_** 按钮，选择 **_"IDC"_** 菜单项，弹出新建缓存对话框。
2. 列表显示所有可缓存的位置信息，包括平台、区域、可用区、IP、缓存位置、SN等信息。
3. 支持在搜索框中根据IP和SN信息搜索符合条件的宿主机或直接在列表中勾选宿主机。
4. 单击 **_"确定"_** 按钮，完成操作。

##### 缓存到私有云

私有云的缓存位置具体到宿主机。

1. 在缓存页面页面，单击列表上方 **_"新建"_** 按钮，选择 **_"私有云"_** 菜单项，弹出新建缓存对话框。
2. 支持根据平台、云订阅、区域等筛选出符合条件的私有云平台或直接在列表中勾选缓存位置。
3. 单击 **_"确定"_** 按钮，完成操作。

##### 缓存到公有云

公有云缓存位置具体到区域。

1. 在缓存页面页面，单击列表上方 **_"新建"_** 按钮，选择 **_"公有云"_** 菜单项，弹出新建缓存对话框。
2. 支持根据平台、云订阅、区域等筛选出符合条件的私有云平台或直接在列表中勾选缓存位置。
3. 单击 **_"确定"_** 按钮，完成操作。

### 查看操作日志

该功能用于查看系统镜像相关操作的日志信息

1. 在系统镜像详情页面，单击“操作日志”页签，进入操作日志页面。
    - 加载更多日志：列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 **_"加载更多"_** 按钮，获取更多日志信息。
    - 查看日志详情：单击操作日志右侧操作列 **_"查看"_** 按钮，查看日志的详情信息。支持复制详情内容。
    - 查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。
    - 导出日志：目前仅支持导出本页显示的日志。单击右上角![](../../../images/system/download.png)图标，在弹出的导出数据对话框中，设置导出数据列，单击 **_"确定"_** 按钮，导出日志。
